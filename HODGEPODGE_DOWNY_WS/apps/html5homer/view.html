<canvas id="homerCanvas" width="940" height="210"></canvas>
{literal}
<script>  
var PANEL_HEIGHT = document.getElementById('homerCanvas').height;
var PANEL_WIDTH = document.getElementById('homerCanvas').width;
var HOMER_HEIGHT = 96;
var HOMER_WIDTH = 215;
var SUN_HEIGHT = 80;
var SUN_WIDTH = 80;

var myCanvas = document.getElementById("homerCanvas");
var context = myCanvas.getContext("2d");

function drawSun(){
	var t = new Date();
	t = t.getSeconds() % 3;

	// 背景
	context.beginPath();
	context.fillStyle = "#3F92D2";
	context.fillRect(0, 0, SUN_WIDTH, SUN_HEIGHT);
	context.stroke();

	// 中心
	context.beginPath();
	var sun_color = [["#FF6C00", "#FF6C00"], ["#FFEA00", "#FFEA00"], ["#FF0000", "#FF0000"]];
	context.fillStyle = sun_color[t][0];
	context.strokeStyle = sun_color[t][1];
	context.arc(40, 40, 20, 0, Math.PI * 2, true);
	context.fill();
	context.stroke();

	// 日珥
	context.beginPath();
	var sun_contour = [
		[[40, 10, 40, 15], [60, 20, 72, 8], [65, 40, 70, 40], [60, 60, 72, 72], [40, 65, 40, 70], [8, 72, 20, 60], [10, 40, 15, 40], [8, 8, 20, 20]],
		[[40, 5, 40, 15], [60, 20, 72, 8], [65, 40, 75, 40], [60, 60, 72, 72], [40, 65, 40, 75], [8, 72, 20, 60], [5, 40, 15, 40], [8, 8, 20, 20]],
		[[40, 0, 40, 15], [60, 20, 72, 8], [65, 40, 80, 40], [60, 60, 72, 72], [40, 65, 40, 80], [8, 72, 20, 60], [0, 40, 15, 40], [8, 8, 20, 20]]
	];
	for(var i = 0; i < sun_contour[t].length; i++){
		drawLine(sun_contour[t][i][0], sun_contour[t][i][1], sun_contour[t][i][2], sun_contour[t][i][3]);
	}
	context.stroke();
}

// 宽215 高96
function drawHomer(x, y){
	// 偏移修正
	x = x - 55 - HOMER_WIDTH / 2;
	x = x + 53 < 0 ? -53 : x;
	x = x > PANEL_WIDTH - HOMER_WIDTH - 2 ? PANEL_WIDTH - HOMER_WIDTH - 2 : x;
	y = PANEL_HEIGHT - HOMER_HEIGHT - 15;

	// 背景
	context.beginPath();
	context.fillStyle = "#009900";
	context.fillRect(0, PANEL_HEIGHT * 0.4, PANEL_WIDTH, PANEL_HEIGHT);
	context.stroke();

	// 前景
	context.strokeStyle = "#000000";
	context.lineWidth = 2;

	var homer_contour_arc = [
		[70, 22, 7, 0.6, 2.1], [130, 22, 7, 0.8, 2.3],	// 耳朵
		[61, 81, 6, 0.3, 1.3], [139, 81, 6, 1.7, 0.7],	// 脸
		[78, 75, 5, 0.7, 0.3], [123, 75, 5, 0.7, 0.3],	// 鼻子
		[167, 69, 50, 1.6, 1.9]							// 身体
	];
	for(var i = 0; i < homer_contour_arc.length; i++){
		drawArc(
			homer_contour_arc[i][0] + x,
			homer_contour_arc[i][1] + y,
			homer_contour_arc[i][2],
			homer_contour_arc[i][3] * Math.PI,
			homer_contour_arc[i][4] * Math.PI
		);
	}

	var homer_contour_strokeRect = [
		[70, 87, 15, 3], [115, 87, 15, 3]	// 牙齿
	];
	for(var i = 0; i < homer_contour_strokeRect.length; i++){
		drawStrokeRect(
			homer_contour_strokeRect[i][0] + x,
			homer_contour_strokeRect[i][1] + y,
			homer_contour_strokeRect[i][2],
			homer_contour_strokeRect[i][3]
		);
	}

	var homer_contour_line = [
		[138, 22, 185, 22], [215, 52, 215, 110],												// 身体
		[75, 25, 125, 25], [64, 87, 136, 87], [67, 27, 55, 80], [133, 27, 145, 80],				// 头型
		[58, 53, 85, 53], [115, 53, 142, 53],													// 眼睛
		[95, 110, 115, 110], [125, 110, 145, 110], [165, 110, 185, 110], [195, 110, 215, 110],	// 脚1
		[95, 87, 95, 110], [115, 110, 115, 100], [125, 110, 125, 100], [145, 110, 145, 100],	// 脚2
		[165, 110, 165, 100], [185, 110, 185, 100], [195, 110, 195, 100], [115, 100, 125, 100],	// 脚3
		[145, 100, 165, 100], [185, 100, 195, 100]												// 脚4
	];
	for(var i = 0; i < homer_contour_line.length; i++){
		drawLine(
			homer_contour_line[i][0] + x,
			homer_contour_line[i][1] + y,
			homer_contour_line[i][2] + x,
			homer_contour_line[i][3] + y
		);
	}
}

function drawArc(x, y, r, sa, ea){
	context.beginPath();
	context.arc(x, y, r, sa, ea);
	context.stroke();
}
function drawStrokeRect(fx, fy, tx, ty){
	context.beginPath();
	context.strokeRect(fx, fy, tx, ty);	
	context.stroke();
}
function drawLine(fx, fy, tx, ty){
	context.beginPath();
	context.moveTo(fx, fy);
	context.lineTo(tx, ty);
	context.stroke();
}

context.beginPath();
context.fillStyle = "#3F92D2";
context.fillRect(0, 0, PANEL_WIDTH, PANEL_HEIGHT * 0.4);
context.stroke();
drawSun();
drawHomer(PANEL_WIDTH - HOMER_WIDTH, PANEL_HEIGHT - HOMER_HEIGHT);
setInterval("drawSun()", 250);
myCanvas.addEventListener('mousemove', function(event){
	drawHomer(event.layerX - document.getElementById('homerCanvas').offsetLeft, 0);
});
</script>
{/literal}

<link type="text/css" rel="stylesheet" href="{$smarty.const.RESOURCES_DOMAIN}jquery.ui/1.10.4/cupertino/jquery-ui-1.10.4.custom.min.css" />
<link type="text/css" rel="stylesheet" href="{$smarty.const.RESOURCES_DOMAIN}jquery/colorpicker-master/css/evol.colorpicker.css" />
<script type="text/javascript" src="{$smarty.const.RESOURCES_DOMAIN}jquery.ui/1.10.4/jquery-ui-1.10.4.custom.min.js"></script>
<script type="text/javascript" src="{$smarty.const.RESOURCES_DOMAIN}jquery/colorpicker-master/js/evol.colorpicker.js"></script>
<script type="text/javascript" src="{$smarty.const.RESOURCES_DOMAIN}jquery/jquery.downy.ext.js"></script>
<form method="post" action="/app_{$config.key}.html" name="app" target="_blank">
	<input type="hidden" name="ajax" value="0" />
	<table class="ctrl"><tr>
		<th class="item" valign="top">内容*</th><td class="item" colspan="3"><textarea name="content"></textarea></td>
	</tr><tr>
		<th class="item">纠错能力</th><td class="item" colspan="3">
			<input type="radio" value="0" name="level" id="level_l" /><label class="tit" for="level_l">L - 7%</label>
			<input type="radio" value="1" name="level" id="level_m" /><label class="tit" for="level_m">M - 15%</label>
			<input type="radio" value="2" name="level" id="level_q" /><label class="tit" for="level_q">Q - 25%</label>
			<input type="radio" value="3" name="level" id="level_h" /><label class="tit" for="level_h">H - 30%</label>
		</td>
	</tr><tr>
		<th class="item" width="80px">点粗细</th><td class="item"><select name="size">
			<option value="">请选择</option><option value="1">1</option><option value="2">2</option><option value="3">3</option>
			<option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option>
			<option value="8">8</option><option value="9">9</option><option value="10">10</option>
		</select></td>
		<th class="item" width="80px">边框大小</th><td class="item"><select name="margin">
			<option value="">请选择</option><option value="0">0</option><option value="1">1</option><option value="2">2</option>
			<option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option>
			<option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>
		</select></td>
	</tr><tr>
		<th class="item">前景颜色</th><td class="item"><input type="text" name="color" class="w55" /></td>
		<th class="item">背景颜色</th><td class="item"><input type="text" name="bgcolor" class="w55" /></td>
	</tr><tr>
		<td colspan="4" class="item btns">
			<input type="button" value="生成" />
			<input type="submit" name="download" value="下载" />
		</td>
	</tr></table>
	<div class="result"></div>
</form>
{literal}
<style type="text/css">
	.app .w25{width:25px;text-align:center;}
	.app .w55{width:55px;text-align:center;}
	.app .w200{width:200px;}
	.app textarea{width:100%;box-sizing:border-box;height:123px;}
	.app label.tit{margin:0px 5px;}
	.app label.tit.l{margin:0px 5px 0px 20px;}
	.app table.ctrl{width:600px;box-shadow:1px 2px 3px #666666;float:left;}
	.app table.ctrl tr th.item, .app table.ctrl tr td.item{padding:10px 10px;border:1px solid #D6D6D6;}
	.app table.ctrl tr td.item:hover{border:1px solid #4D90FE;box-shadow:1px 2px 3px #666666;}
	.app .btns{text-align:center;}
	.app .btns input{margin:0px 10px;}
	.app .result{width:300px;height:300px;float:right;box-shadow:1px 2px 3px #666666;padding:10px;overflow:hidden;text-align:center;}
	.app .result img{max-width:300px;max-height:300px;}
	.app .result .msg{text-align:left;color:#FF0000;font-size:14px;}
	.app .result .msg li{list-style:none;}
</style>
{/literal}
<script type="text/javascript">
var DATA = {json_encode($data)};
{literal}
function imgMiddle(){
	var h_div = $('.app .result').height();
	var h_img = $('.app .result img').height();
	$('.app .result img').css('margin-top', ((h_div - h_img) / 2) + 'px');
}
function errorMsg(content){
	$('.app .result').html('<ul class="msg"></ul>');
	for(var key in content){
		$('.app .result .msg').append('<li class="currnet"></li>');
		$('.app .result .msg .currnet').text(content[key]).removeClass('currnet');
	}
}
$(".app input[name=color], .app input[name=bgcolor]").colorpicker({valign_top: true});
$('.app input[value="生成"]').click(function(){
	$('.app input[name=ajax]').val(1);
	$.fn.dyAjaxForm('form[name=app]', {
		dataType: 'JSON',
		onEvent: {
			success: function(result){
				if(result.message){
					errorMsg(result.message);
				}else{
					$('.app .result').html('<img src="' + result.img + '" onload="imgMiddle()" />');
				}
			}, error: function(jqXHR, textStatus, errorThrown){
				errorMsg([JSON.stringify(jqXHR)]);
			}
		}
	});
	$('.app input[name=ajax]').val(0);
});

$('.app select[name=type]').val(DATA.type);
$('.app input[name=code]').val(DATA.code);
if(typeof(DATA.code) != 'undefined' && DATA.code != ''){
	$('.app input[value="生成"]').click();
}
{/literal}
</script>

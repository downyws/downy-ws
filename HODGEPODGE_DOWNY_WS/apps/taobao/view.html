<div class="ctrl">
	<div class="list">
		{if empty($data)}
			<div class="item"><input type="text" /></div>
		{/if}
		{foreach from=$data item=v}
			<div class="item"><input type="text" value="{$v}" /></div>
		{/foreach}
	</div>
	<div class="operate">
		<input type="button" value="add" />
		<input type="button" value="sub" />
		<input type="button" value="create" />
	</div>
	<div>[　][％][０][１][２][３][４][５][６][７][８][９]</div>
</div>
<div class="output"><textarea></textarea></div>
{literal}
<style type="text/css">
	.app .ctrl{padding:0px 10px 10px;}
	.app .ctrl div{margin-bottom:5px;}
	.app .output{border-top:1px solid #D9D9D9;padding:10px 10px 0px;}
	.app .output textarea{width:100%;}
</style>
<script type="text/javascript">
	var MAX_LENGTH = 48;
	var KEY = {
		"KB": "　", 
		"H": "一", 
		"S": "┃", 
		"ZS": "┏", 
		"YS": "┓", 
		"ZX": "┗", 
		"YX": "┛"
	};
	$(function(){
		$("input[value=add]").data("html", $(".list").html()).click(function(){
			$(".list").append($(this).data("html"));
		});
		$("input[value=sub]").click(function(){
			$(".list div:last-child").remove();
		});
		$("input[value=create]").click(function(){
			var count = 0;
			var list = [];
			var length = 0;
			var space = [false, false, ""];
			var result = ["", "", ""];
			$(".list div input").each(function(){
				count++;
				list.push($(this).val());
				length += $(this).val().length;
			});

			if(length + count * 2 > MAX_LENGTH){
				alert("max length error.");
				return;
			}

			// 外间隔
			space[0] = MAX_LENGTH >= (length + count * 2 + count - 1);
			// 内间隔
			space[1] = MAX_LENGTH >= (length + count * 2 + count - 1 + count * 2);
			// 尾间隔
			temp = MAX_LENGTH - length - count * 2;
			if(space[0]){
				temp -= count - 1;
			}
			if(space[1]){
				temp -= count * 2;
			}
			if(count == 1){
				temp--;
			}
			while(temp > 0){
				temp--;
				space[2] += KEY.KB;
			}
			space[2] += " " + KEY.KB + " ";

			// 生成
			for(var i = 0; i < list.length; i++){
				// 补外间隔，非第一个
				if(i != 0 && space[0]){
					result[0] += KEY.KB;
					result[2] += KEY.KB;
					result[1] += KEY.KB;
				}
				// 左边角
				result[0] += KEY.ZS;
				result[2] += KEY.ZX;
				result[1] += KEY.S;
				// 补内间隔
				if(space[1]){
					result[0] += KEY.H + KEY.H;
					result[2] += KEY.H + KEY.H;
				}
				// 横条
				for(var j = 0; j < list[i].length; j++){
					result[0] += KEY.H;
					result[2] += KEY.H;
				}
				result[1] += space[1] ? KEY.KB + list[i] + KEY.KB: list[i];
				// 右边角
				result[0] += KEY.YS;
				result[2] += KEY.YX;
				result[1] += KEY.S;
			}

			$("textarea").val(result[0] + space[2] + result[1] + space[2] + result[2]);
		});
		{/literal}
		{if !empty($data)}$("input[value=create]").click();{/if}
		{literal}
	});
</script>
{/literal}

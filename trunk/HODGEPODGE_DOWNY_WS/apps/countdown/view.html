<div class="clock"></div>
<div class="loadbar"><div></div></div>
<input type="button" class="panbtn" value="1" />
<input type="button" class="panbtn" value="2" />
<input type="button" class="panbtn" value="3" />
<input type="button" class="panbtn" value="4" />
<input type="button" value="开始" />
<input type="button" class="panbtn" value="5" />
<input type="button" class="panbtn" value="6" />
<input type="button" class="panbtn" value="7" />
<input type="button" class="panbtn" value="8" />
<input type="button" value="暂停" />
<input type="button" class="panbtn" value="9" />
<input type="button" class="panbtn" value="0" />
<input type="button" class="panbtn" value="←" />
<input type="button" class="panbtn" value="C" />
<input type="button" value="复位" />
<audio preload='auto' id='app_alarm' src='{$smarty.const.RESOURCES_DOMAIN}hodgepodge_downy_ws/{$config.key}/alarm_1.ogg' loop="loop"></audio>
{literal}
<style type="text/css">
	.app .clock{font-size:80px;padding:15px 40px;height:140px;width:600px;margin-right:30px;border:5px solid #D6D6D6;text-align:center;float:left;box-sizing:border-box;font-family:Tahoma;}
	.app .clock:hover{border:5px solid #4D90FE;box-shadow:1px 2px 3px #666666;}
	.app .loadbar{background:#D6D6D6;width:600px;float:left;}
	.app .loadbar div{width:0px;background:#CC0000;height:5px;}
	.app input[type=button]{border-radius:5px;color:#FFFFFF;border: 5px solid #3079ED;font-size:20px;padding:5px 10px;margin-left:15px;margin-bottom:5px;cursor:pointer;background:#4d90FE;}
	.app input[type=button]:hover{background:#357AE8;border: 5px solid #2F5BB7;}
	.app input[type=button].panbtn{width:45px;height:45px;margin-left:5px;}
	.app input[type=button].red{background:#e46f61;border: 5px solid #DD4B39;}
	.app input[type=button].red:hover{background:#DD4B39;border: 5px solid #d73d32;}
</style>
<script type="text/javascript">	// alarm_1.ogg
var clockpoint = null;
var clockstart = null;
var clocklave = null;
var clockscreen = '';
var clocksound = null;
var ALERTCOLOR = ['#FFFF00', '#FF0000', '#EEEE00', '#EE0000', '#DDDD00', '#DD0000'];
var ALERTCOLORCOUNT = ALERTCOLOR.length;
function clock(){
	var val = '', lave = clocklave * 1000 - (new Date().valueOf() - clockstart), temp = null;
	if(lave / 1000 > 0){
		temp = $('.app .loadbar div').data('amount') * 1000;
		temp = (temp - lave + 500) / temp * 100;
		temp = temp >= 100 ? 99 : temp;
		$('.app .loadbar div').css('width', temp + '%');

		lave = parseInt(lave / 1000);

		temp = lave % 60;
		val += (temp > 9 ? temp : ('0' + temp));

		temp = parseInt(lave % 3600 / 60);
		val = (temp > 9 ? temp : ('0' + temp)) + val;

		val = parseInt(lave / 3600) + val;
	}else{
		if(clocksound == null){
			clocksound = document.getElementById('app_alarm');
			clocksound.play();

			clocklave = 0;
			$('.app .loadbar div').css('width', '100%');
			$('.app input[value="复位"]').addClass('red');
		}
		$('.app .clock').css({'background': ALERTCOLOR[parseInt(Math.random() * ALERTCOLORCOUNT)], 'color': '#FFFFFF'});
	}
	refreshScreen(val);
}
function refreshScreen(val){
	while(val.length < 5){
		val = '0' + val;
	}
	if(val.length < 6){
		val = ' ' + val;
	}
	$('.app .clock').html(val.substring(0, 2) + '时' + val.substring(2, 4) + '分' + val.substring(4, 6) + '秒');
}
$('.app .panbtn').click(function(){
	if(clockstart == null){
		var val = $(this).val();
		if(!isNaN(val)){
			clockscreen += val;
		}else if(val == 'C'){
			clockscreen = '';
		}else{
			clockscreen = clockscreen.substring(0, clockscreen.length - 1);
		}
		while(clockscreen.length < 5){
			clockscreen = '0' + clockscreen;
		}
		if(clockscreen.length > 5){
			clockscreen = clockscreen.substring(clockscreen.length - 5);
		}
		refreshScreen(clockscreen);
	}
});
$('body').keypress(function(event){
	var keyCode = event.which;
	if(keyCode >= 48 && keyCode <= 57){
		$('.app input[type=button][value=' + (keyCode - 48) + ']').click();
	}
});
$('.app input[value="开始"]').click(function(){
	if(clockpoint == null){
		if(clocklave == null){
			clocklave = parseInt(clockscreen.substring(0, 1)) * 60 * 60
						+ parseInt(clockscreen.substring(1, 3)) * 60
						+ parseInt(clockscreen.substring(3, 5));
			clocklave = clocklave > 0 ? clocklave : null;
		}
		if(clocklave != null){
			$('.app .loadbar div').data('amount', clocklave);
			$('.app .clock').css('color', '#009900');
			clockstart = new Date().valueOf();
			clockpoint = setInterval('clock()', 250);
		}
	}
});
$('.app input[value="暂停"]').click(function(){
	if(clockpoint != null && clocklave > 0){
		clearInterval(clockpoint);
		clockpoint = null;
		clocklave -= new Date().valueOf() - clockstart;
		clockstart = null;
		$('.app .clock').css('color', '#990000');
	}
});
$('.app input[value="复位"]').click(function(){
	if(clockpoint != null){
		clearInterval(clockpoint);
	}
	if(clocksound != null){
		clocksound.pause();
		clocksound.currentTime = 0.0; 
	}
	clockpoint = null;
	clockstart = null;
	clocklave = null;
	clocksound = null;
	refreshScreen(clockscreen);
	$(this).removeClass('red');
	$('.app .loadbar div').data('amount', 0).css('width', '0px');
	$('.app .clock').css({'background': '#FFFFFF', 'color': '#000000'});
}).click();
</script>
{/literal}

<link type="text/css" rel="stylesheet" href="{$smarty.const.RESOURCES_DOMAIN}jquery.ui/1.10.4/cupertino/jquery-ui-1.10.4.custom.min.css" />
<script type="text/javascript" src="{$smarty.const.RESOURCES_DOMAIN}jquery/jquery.downy.ext.js"></script>
<script type="text/javascript" src="{$smarty.const.RESOURCES_DOMAIN}jquery.ui/1.10.4/jquery-ui-1.10.4.custom.min.js"></script>
<script type="text/javascript" src="{$smarty.const.RESOURCES_DOMAIN}jquery/jquery-ui-timepicker-addon.js"></script>
<div class="b1">
	<label>Now Unix timestamp</label>
	<input type="text" onfocus="this.select();" />
	<input type="button" value="继续" />
	<input type="button" value="暂停" />
	<input type="button" value="刷新" />
</div>
<div class="b2">
	<label>Unix timestamp</label>
	<input type="text" maxlength="10" class="val" />
	<input type="button" value="转换" />
	<input type="text" class="result date" readonly="readonly" />
</div>
<div class="b3">
	<label>Date</label>
	<input type="text" class="val date" maxlength="19" />
	<input type="button" value="转换" />
	<input type="text" class="result" readonly="readonly" />
</div>
{literal}
<style type="text/css">
	.app {font-size:16px;}
	.app input[type=text]{border:1px solid #D6D6D6;padding:5px 10px;font-size:16px;color:#009900;text-align:center;width:100px;margin:0px 10px 0px 15px;}
	.app input[type=text]:hover{box-shadow:1px 2px 3px #666666;}
	.app input[type=text]:focus{border:1px solid #4D90FE;box-shadow:1px 2px 3px #666666;}
	.app input[type="button"]{background:#4d90FE;border: 1px solid #3079ED;color:#FFFFFF;padding:5px 15px;border-radius:2px;font-weight:bold;font-size:14px;cursor:pointer;margin-left:5px;}
	.app input[type="button"]:hover{background:#357AE8;border: 1px solid #2F5BB7;}
	.app input.date{width:150px;}
	.app div{margin-bottom:50px;}
</style>
{/literal}
<script type="text/javascript">
var DATA = {json_encode($data)};
{literal}
// b1
var clockpoint = null;
function clock(){
	$('.app .b1 input[type=text]').val(parseInt((new Date()).valueOf() / 1000));
}
$('.app .b1 input[value="继续"]').click(function(){
	if(clockpoint == null){
		clockpoint = setInterval('clock()', 250);
		$('.app .b1 input[type=text]').css('color', '#009900');
	}
}).click();
$('.app .b1 input[value="暂停"]').click(function(){
	if(clockpoint != null){
		clearInterval(clockpoint);
		clockpoint = null;
		$('.app .b1 input[type=text]').css('color', '#CC0000');
	}
});
$('.app .b1 input[value="刷新"]').click(function(){
	if(clockpoint == null){
		clock();
	}
});

// b2
$('.app .b2 input[value="转换"]').click(function(){
	var val = $('.app .b2 .val').val();
	if(parseInt(val) == val){
		$('.app .b2 .result').val($.fn.convertTimestamp(val, 'yyyy-MM-dd hh:mm:ss'));
	}else{
		$('.app .b2 .result').val('timestamp error.');
	}
});

// b3
$('.app .b3 .val').datetimepicker({
	dateFormat: 'yy-mm-dd',
	timeFormat: 'hh:mm:ss',
	showSecond: true
});
$('.app .b3 input[value="转换"]').click(function(){
	var val = $('.app .b3 .val').val();
	var reg = /^20[0-9]{2}(\-[0-9][0-9]){2}\ [0-9]{2}(\:[0-9][0-9]){2}$/;
	if(reg.test(val)){
		var val = [
			parseInt(val.substring(0, 4)),
			parseInt(val.substring(5, 7)) - 1,
			parseInt(val.substring(8, 10)),
			parseInt(val.substring(11, 13)),
			parseInt(val.substring(14, 16)),
			parseInt(val.substring(17, 19)),
		];
		var timezone = new Date().getTimezoneOffset() * 60;
		$('.app .b3 .result').val(parseInt(Date.UTC(val[0], val[1], val[2], val[3], val[4], val[5]) / 1000) + timezone);
	}else{
		$('.app .b3 .result').val('date error.');
	}
});

if(DATA.type == 'todate'){
	$('.app .b2 .val').val(DATA.timestamp);
	$('.app .b2 input[type=button]').click();
}else if(DATA.type == 'tostamp'){
	$('.app .b3 .val').val(DATA.date);
	$('.app .b3 input[type=button]').click();
}
{/literal}
</script>
